version: '3'

vars:
  BUILD_DIR: "./build/"
  WEB_BUILD_DIR: "./build-web/"
  OUT_FILE: "jamegam"

tasks:
  prepare:
    internal: true
    desc: "Does build prep (create dirs, copy files, ...)"
    cmds:
      - mkdir -p "{{.WEB_BUILD_DIR}}"
      - mkdir -p "{{.BUILD_DIR}}"
    
  build:
    desc: "Builds the executable, with preparation"
    deps: ["prepare"]
    cmds:
      - go build -o "{{.BUILD_DIR}}{{.OUT_FILE}}"

  run:
    desc: "Runs the built executable"
    cmds:
      - "{{.BUILD_DIR}}{{.OUT_FILE}}"

  build-web:
    desc: "Builds the project for wasm"
    deps: ["prepare"]
    env:
      GOOS: js
      GOARCH: wasm
    cmds:
      - cp ./wasm_exec.js "{{.WEB_BUILD_DIR}}"
      - cp index.html "{{.WEB_BUILD_DIR}}"
      - go build -o "{{.WEB_BUILD_DIR}}{{.OUT_FILE}}.wasm"

  dev:
    desc: "(Re-)Builds and runs the executable"
    cmds:
      - task: build
      - task: run
